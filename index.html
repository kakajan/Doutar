<!DOCTYPE html>
<html lang="fa" dir="rtl" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <title>میراث صحرا | تجربه شنیداری اشعار مختومقلی فراغی</title>
    <meta name="description" content="دانلود آلبوم موسیقی حماسی میراث صحرا. تلفیق دوتار ترکمن، قیجیق و ارکسترال مدرن بر روی اشعار مختومقلی فراغی. کاری از گروه آی‌ترونیک.">
    <meta name="keywords" content="مختومقلی فراغی, موسیقی ترکمن, دوتار, آهنگ حماسی, میراث صحرا, Magtymguly Pyragy, Turkmen Music, دانلود آهنگ ترکمنی">
    <meta name="author" content="Aytronic - x-dev">
    <meta name="robots" content="index, follow">
    <meta name="theme-color" content="#F9F7F2">

    <meta property="og:type" content="music.album">
    <meta property="og:url" content="https://doutar.ir">
    <meta property="og:title" content="میراث صحرا | Magtymguly Pyragy">
    <meta property="og:description" content="سفری حماسی به قلب تاریخ ترکمن. تلفیقی مدرن از نوای دوتار و کلام جاودان مختومقلی.">
    <meta property="og:image" content="https://doutar.ir/assets/img/cover.webp"> <meta property="og:locale" content="fa_IR">

    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://doutar.ir">
    <meta property="twitter:title" content="میراث صحرا | Magtymguly Pyragy">
    <meta property="twitter:description" content="دانلود آلبوم موسیقی حماسی میراث صحرا. تلفیق دوتار ترکمن و ارکسترال.">
    <meta property="twitter:image" content="https://doutar.ir/assets/img/cover.webp">

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Vazirmatn:wght@100..900&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        gold: '#D4AF37',
                        'dark-gold': '#B4941F',
                        'sand-light': '#F9F7F2',
                        'sand-dark': '#EBE5CE',
                        'deep-black': '#1a1a1a',
                    },
                    fontFamily: {
                        'epic': ['Cinzel', 'serif'],
                        'body': ['Vazirmatn', 'sans-serif'],
                    }
                }
            }
        }
    </script>

    <style>
        body {
            background-color: #F9F7F2;
            color: #1a1a1a;
            font-family: 'Vazirmatn', sans-serif;
            overflow-x: hidden;
        }

        /* Animated Background Mesh */
        .bg-mesh {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: 
                radial-gradient(circle at 10% 20%, rgba(212, 175, 55, 0.15), transparent 40%),
                radial-gradient(circle at 90% 80%, rgba(235, 229, 206, 0.8), transparent 40%);
            z-index: -2;
            pointer-events: none;
        }

        #dust-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            opacity: 0.8;
            pointer-events: none;
        }

        /* Glass Card Styles */
        .glass-card {
            background: rgba(255, 255, 255, 0.65);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.8);
            box-shadow: 0 10px 30px -5px rgba(0, 0, 0, 0.05);
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .glass-card:hover {
            background: rgba(255, 255, 255, 0.85);
            border-color: #D4AF37;
            transform: translateY(-5px);
            box-shadow: 0 20px 40px -5px rgba(212, 175, 55, 0.2);
        }

        .glass-card.playing {
            border-color: #D4AF37;
            background: linear-gradient(180deg, rgba(255, 255, 255, 0.95) 0%, rgba(255, 248, 225, 1) 100%);
            box-shadow: 0 0 0 2px rgba(212, 175, 55, 0.2);
        }

        /* Play Button */
        .play-btn-wrapper {
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 9999px;
            background: #1a1a1a;
            color: #D4AF37;
            transition: transform 0.3s ease;
        }
        
        .play-btn-wrapper::before {
            content: '';
            position: absolute;
            inset: -3px;
            border-radius: 9999px;
            background: linear-gradient(45deg, #D4AF37, transparent, #D4AF37);
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: -1;
            animation: spin 4s linear infinite;
        }
        .glass-card:hover .play-btn-wrapper::before {
            opacity: 1;
        }
        .glass-card.playing .play-btn-wrapper::before {
            opacity: 1;
            animation-duration: 2s;
        }

        @keyframes spin { 100% { transform: rotate(360deg); } }

        /* Visualizer */
        .viz-bar {
            width: 3px;
            background-color: #1a1a1a;
            border-radius: 2px;
            height: 4px;
            transition: height 0.1s ease;
        }
        .playing .viz-bar {
            background-color: #D4AF37;
            animation: bounce 0.5s infinite ease-in-out alternate;
        }
        
        @keyframes bounce { 
            0% { height: 4px; opacity: 0.5; } 
            100% { height: 24px; opacity: 1; } 
        }

        /* Utils */
        .text-gradient-gold {
            background: linear-gradient(to bottom, #D4AF37, #8a6e2f);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        ::selection { background: #D4AF37; color: #fff; }
        
        html { scroll-behavior: smooth; }
    </style>
</head>
<body class="antialiased">

    <div class="bg-mesh"></div>
    <canvas id="dust-canvas"></canvas>

    <nav class="fixed top-0 w-full z-50 px-8 py-6 flex justify-between items-center transition-all duration-300 ease-in-out" id="navbar">
        <div class="text-xl font-bold tracking-[0.2em] font-epic text-black/90">AYTRONIC</div>
        <a href="#download" class="text-xs font-bold tracking-widest uppercase border border-black/10 px-6 py-2 rounded-full hover:bg-black hover:text-white transition-all duration-300">
            دانلود پکیج
        </a>
    </nav>

    <header class="relative h-screen flex flex-col justify-center items-center text-center px-4 overflow-hidden z-10">
        <div class="space-y-6 relative z-20">
            <h2 class="text-dark-gold tracking-[0.5em] text-xs md:text-sm font-epic uppercase font-bold" id="hero-subtitle">
                Magtymguly Pyragy
            </h2>
            <h1 class="text-7xl md:text-9xl font-black leading-tight font-epic text-neutral-900" id="hero-title">
                <span class="block text-gradient-gold drop-shadow-sm">MIRAS</span>
                <span class="block text-black/5 text-6xl md:text-8xl mt-[-0.3em]">SAHRASY</span>
            </h1>
            <p class="max-w-md mx-auto text-neutral-600 text-base md:text-lg leading-loose font-light pt-4" id="hero-desc">
                تجربه‌ای شنیداری از تلفیق سنت و مدرنیته. <br>
                بازآفرینی اشعار <span class="font-bold text-black">مختومقلی</span> با تکنولوژی هوش مصنوعی.
            </p>
            <div class="pt-10" id="hero-btn">
                <a href="#music-hall" class="group relative inline-flex items-center justify-center px-10 py-4 text-sm font-bold text-white transition-all duration-300 bg-black rounded-full hover:bg-gold hover:shadow-xl hover:shadow-gold/30">
                    <span class="relative flex items-center gap-3 tracking-widest uppercase">
                        شروع شنیدن
                        <svg class="w-4 h-4 transition-transform group-hover:translate-y-1" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3"></path></svg>
                    </span>
                </a>
            </div>
        </div>
    </header>

    <section id="music-hall" class="py-32 relative z-10">
        <div class="container mx-auto px-6 max-w-6xl">
            <div class="flex items-end justify-between mb-20 border-b border-black/5 pb-4" id="music-header">
                <div>
                    <h2 class="text-4xl text-black font-body font-bold">آرشیو آثار</h2>
                    <p class="text-neutral-500 mt-2 text-sm font-light">نسخه مورد نظر را انتخاب کنید</p>
                </div>
                <div class="text-gold font-mono text-xs hidden md:block" id="track-counter">/// LOADING TRACKS</div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6" id="music-grid">
                </div>
        </div>
    </section>

    <section class="py-40 relative z-10 border-t border-black/5">
        <div class="container mx-auto text-center px-4">
            <h3 class="text-neutral-400 font-epic tracking-[0.5em] text-xs mb-32" id="lyrics-title">LYRICS HIGHLIGHT</h3>
            <div class="space-y-16" id="lyrics-container">
                <p class="text-4xl md:text-7xl font-black text-neutral-300 lyric-line transition-all duration-300 cursor-default">
                    آی ترکمن! اسب را زین کن
                </p>
                <p class="text-4xl md:text-7xl font-black text-neutral-300 lyric-line transition-all duration-300 cursor-default">
                    زمانِ خواب نیست
                </p>
                <p class="text-4xl md:text-7xl font-black text-neutral-300 lyric-line transition-all duration-300 cursor-default">
                    آبِ این دنیا سراب است
                </p>
                <p class="text-4xl md:text-7xl font-black text-neutral-300 lyric-line transition-all duration-300 cursor-default">
                    زلال و ناب نیست
                </p>
            </div>
        </div>
    </section>

    <footer id="download" class="py-20 text-center relative z-10 bg-gradient-to-t from-black/5 to-transparent">
        <div class="container mx-auto px-4" id="footer-content">
            <button class="bg-black text-white font-bold py-5 px-12 text-sm tracking-widest uppercase hover:bg-gold hover:text-black transition-all duration-300 shadow-xl shadow-black/10 rounded-full">
                Download Full Album (ZIP)
            </button>
            <div class="mt-16 text-[10px] text-neutral-400 font-epic tracking-widest uppercase">
                AYTRONIC © 2025 | Created by x-dev
            </div>
        </div>
    </footer>

    <script>
        // --- 1. DATA: Generate 28 Tracks Automatically ---
        const trackData = Array.from({ length: 28 }, (_, i) => {
            const num = (i + 1).toString().padStart(2, '0');
            return {
                id: `track${i + 1}`,
                title: `[MIRAS SAHRASY #${num}] Miras Sahrasy`,
                subtitle: `Aytronic`,
                file: `assets/music/track${i + 1}.mp3`, // مسیر فایل ها: track1.mp3 تا track28.mp3
                vizCount: Math.floor(Math.random() * 5) + 5 // تعداد خطوط ویژوالایزر رندوم
            };
        });

        // --- Helper: Format Time (Seconds to MM:SS) ---
        function formatTime(seconds) {
            if (isNaN(seconds)) return "--:--";
            const m = Math.floor(seconds / 60);
            const s = Math.floor(seconds % 60);
            return `${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
        }

        // --- 2. LOGIC: Dynamic Rendering & Duration Fetching ---
        function renderTracks() {
            const grid = document.getElementById('music-grid');
            const counter = document.getElementById('track-counter');
            
            if(!grid) return;

            // Update Counter
            if(counter) counter.innerText = `/// ${trackData.length.toString().padStart(2, '0')} TRACKS LOADED`;

            grid.innerHTML = trackData.map(track => {
                // Generate Visualizer Bars HTML
                let vizBars = '';
                for(let i=0; i<track.vizCount; i++) {
                    const duration = (Math.random() * 0.4 + 0.3).toFixed(1) + 's';
                    vizBars += `<div class="viz-bar" style="animation-duration: ${duration}"></div>`;
                }

                // Important: Added id to span for duration update
                // Added preload="metadata" to audio tag
                return `
                <div class="glass-card rounded-2xl p-8 flex items-center gap-6 group music-item">
                    <div class="play-btn-wrapper w-16 h-16 shrink-0 cursor-pointer shadow-lg" onclick="togglePlay('${track.id}', this)">
                        <svg class="w-6 h-6 play-icon ml-1" fill="currentColor" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
                        <svg class="w-6 h-6 pause-icon hidden" fill="currentColor" viewBox="0 0 24 24"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>
                        <svg class="w-6 h-6 animate-spin loading-icon hidden text-gold" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                    </div>
                    
                    <div class="flex-1">
                        <div class="flex justify-between items-start mb-2">
                            <h4 class="text-lg font-bold text-neutral-900 group-hover:text-dark-gold transition-colors text-right" dir="ltr">${track.title}</h4>
                            <span id="dur-${track.id}" class="text-[10px] bg-black/5 px-2 py-1 rounded text-neutral-500 font-mono">--:--</span>
                        </div>
                        <p class="text-xs text-neutral-500 mb-4 font-light text-right" dir="ltr">${track.subtitle}</p>
                        
                        <div class="flex items-end gap-1 h-6 viz-container">
                            ${vizBars}
                        </div>
                    </div>

                    <a href="${track.file}" class="text-neutral-400 hover:text-black transition-colors" download>
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/></svg>
                    </a>
                    
                    <audio id="${track.id}" preload="metadata">
                        <source src="${track.file}" type="audio/mpeg">
                    </audio>
                </div>
                `;
            }).join('');

            // --- Attach Metadata Listeners for Automatic Duration ---
            trackData.forEach(track => {
                const audioEl = document.getElementById(track.id);
                const durationSpan = document.getElementById(`dur-${track.id}`);
                
                if(audioEl && durationSpan) {
                    audioEl.addEventListener('loadedmetadata', function() {
                        durationSpan.innerText = formatTime(this.duration);
                    });
                }
            });
        }

        // --- 3. LOGIC: Audio Player ---
        let currentAudio = null;
        let currentBtnWrapper = null;

        async function togglePlay(audioId, btnWrapperElement) {
            const audio = document.getElementById(audioId);
            const playIcon = btnWrapperElement.querySelector('.play-icon');
            const pauseIcon = btnWrapperElement.querySelector('.pause-icon');
            const loadingIcon = btnWrapperElement.querySelector('.loading-icon');
            const card = btnWrapperElement.closest('.glass-card');

            if (!loadingIcon.classList.contains('hidden')) return;

            if (currentAudio === audio && !audio.paused) {
                audio.pause();
                resetUI(btnWrapperElement, card);
                return;
            }

            if (currentAudio && currentAudio !== audio) {
                currentAudio.pause();
                currentAudio.currentTime = 0;
                if (currentBtnWrapper) {
                    const prevCard = currentBtnWrapper.closest('.glass-card');
                    resetUI(currentBtnWrapper, prevCard);
                }
            }

            try {
                playIcon.classList.add('hidden');
                loadingIcon.classList.remove('hidden');

                currentAudio = audio;
                currentBtnWrapper = btnWrapperElement;

                await audio.play();

                loadingIcon.classList.add('hidden');
                pauseIcon.classList.remove('hidden');
                card.classList.add('playing');

                audio.onended = () => resetUI(btnWrapperElement, card);
                audio.onerror = (e) => {
                    console.error("Playback error:", e);
                    alert("مشکل در پخش فایل.");
                    resetUI(btnWrapperElement, card);
                };

            } catch (err) {
                console.error("Audio Load Error:", err);
                loadingIcon.classList.add('hidden');
                playIcon.classList.remove('hidden');
                if(err.name === 'NotSupportedError') alert("فرمت فایل پشتیبانی نمی‌شود.");
            }
        }

        function resetUI(btnWrapper, card) {
            if(!btnWrapper) return;
            const playIcon = btnWrapper.querySelector('.play-icon');
            const pauseIcon = btnWrapper.querySelector('.pause-icon');
            const loadingIcon = btnWrapper.querySelector('.loading-icon');

            playIcon.classList.remove('hidden');
            pauseIcon.classList.add('hidden');
            loadingIcon.classList.add('hidden');
            if(card) card.classList.remove('playing');
        }

        // --- 4. LOGIC: Navbar Scroll ---
        window.addEventListener('scroll', () => {
            const nav = document.getElementById('navbar');
            if (window.scrollY > 20) {
                nav.classList.add('bg-white/80', 'backdrop-blur-md', 'shadow-sm', 'py-4');
                nav.classList.remove('py-6');
            } else {
                nav.classList.remove('bg-white/80', 'backdrop-blur-md', 'shadow-sm', 'py-4');
                nav.classList.add('py-6');
            }
        });

        // --- 5. LOGIC: Particles ---
        const canvas = document.getElementById('dust-canvas');
        const ctx = canvas.getContext('2d');
        let width, height, particles = [];

        function resize() {
            width = canvas.width = window.innerWidth;
            height = canvas.height = window.innerHeight;
            initParticles();
        }
        window.addEventListener('resize', resize);
        
        class Particle {
            constructor() { this.reset(); }
            reset() {
                this.x = Math.random() * width;
                this.y = Math.random() * height;
                this.size = Math.random() * 2;
                this.speedY = Math.random() * -0.5 - 0.1;
                this.opacity = Math.random() * 0.4;
                this.life = Math.random() * 100 + 50;
                this.color = Math.random() > 0.5 ? '212, 175, 55' : '100, 100, 100'; 
            }
            update() {
                this.y += this.speedY;
                this.life--;
                this.opacity -= 0.002;
                if (this.life < 0 || this.opacity <= 0) this.reset();
            }
            draw() {
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fillStyle = `rgba(${this.color}, ${this.opacity})`;
                ctx.fill();
            }
        }

        function initParticles() {
            particles = [];
            for (let i = 0; i < 60; i++) particles.push(new Particle());
        }
        function animateParticles() {
            ctx.clearRect(0, 0, width, height);
            particles.forEach(p => { p.update(); p.draw(); });
            requestAnimationFrame(animateParticles);
        }
        
        // Initializer
        document.addEventListener('DOMContentLoaded', () => {
            renderTracks(); 
            resize(); 
            animateParticles();
        });

    </script>

    <script type="module">
        import { animate, scroll, stagger, inView } from "https://cdn.skypack.dev/motion";

        animate("#navbar", { opacity: [0, 1], y: [-20, 0] }, { duration: 1 });
        animate("#hero-subtitle", { opacity: [0, 1], letterSpacing: ["0em", "0.5em"] }, { duration: 1.5, delay: 0.5 });
        animate("#hero-title", { opacity: [0, 1], scale: [0.95, 1], y: [20, 0] }, { duration: 1.2, delay: 0.8, easing: [0.17, 0.55, 0.55, 1] });
        animate("#hero-desc", { opacity: [0, 1] }, { duration: 1, delay: 1.2 });
        animate("#hero-btn", { opacity: [0, 1], y: [20, 0] }, { duration: 0.8, delay: 1.4 });

        // با توجه به اینکه ترک ها داینامیک لود می شوند، یک تاخیر کوتاه یا آبزرور نیاز است، اما inView معمولا درست کار میکند
        inView("#music-grid", ({ target }) => {
            animate(
                target.querySelectorAll(".music-item"),
                { opacity: [0, 1], y: [30, 0] },
                { duration: 0.6, delay: stagger(0.15) }
            );
        });

        document.querySelectorAll('.lyric-line').forEach(line => {
            scroll(
                animate(line, { 
                    color: ["#d4d4d4", "#1a1a1a", "#d4d4d4"],
                    transform: ["scale(0.95)", "scale(1.1)", "scale(0.95)"],
                }),
                { target: line, offset: ["start end", "end start"] }
            )
        });

        inView("#footer-content", ({ target }) => {
            animate(target, { opacity: [0, 1], y: [20, 0] }, { duration: 0.8 });
        });
    </script>
</body>
</html>